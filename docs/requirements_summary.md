# IROAS BOSS V2 - 重要要件サマリー

## 🎯 プロジェクトの核心
**現行BOSSシステム（月額10万円）を完全に自社開発システムで置き換え、ランニングコストをゼロにする**

## 📊 システム概要
- **対象**: IROASというMLMサービス（会員数50名、新規募集なし）
- **形態**: ブラウザベースのWebアプリケーション（React + FastAPI）
- **目的**: 現行機能の100%再現 + コスト削減

## 💰 決済システム要件
### 決済処理タイミング
- **カード決済**: 月初（1～5日）に対象者CSV出力
- **口座振替**: 月初～12日にCSV出力、27日にUnivapay側で自動実行

### 決済結果CSV形式
**カード決済結果（IPScardresult_YYYYMMDD.csv）**:
- 顧客オーダー番号（会員番号と紐付け）
- 金額
- 決済結果（OK/NG）

**口座振替結果（XXXXXX_TrnsCSV_YYYYMMDDHHMMSS.csv）**:
- 顧客番号（会員番号と紐付け）
- 振替日
- 金額
- エラー情報

### 決済方法（4種類）
1. **カード決済** - Univapay利用
2. **口座振替** - Univapay利用  
3. **銀行振込** - 手動確認後、システムに記録
4. **インフォカート** - 手動確認後、システムに記録

### Univapay連携の流れ
1. システムから決済対象者のCSVデータを出力（カード用・口座振替用で別フォーマット）
2. UnivapayにCSVをインポート（手動）
3. 決済実行後、Univapayから決済結果CSVを出力
4. システムに決済結果を取り込み

## 💎 報酬計算（7種類のボーナス）
**計算タイミング**: 月次（毎月25日頃）

### ボーナス種別
1. **デイリーボーナス** - 参加費に応じた日割り報酬
2. **タイトルボーナス** - タイトルに応じた固定報酬
3. **リファラルボーナス** - 直紹介者の参加費の50%
4. **パワーボーナス** - 組織売上に応じた報酬
5. **メンテナンスボーナス** - センターメンテナンスキット販売報酬
6. **セールスアクティビティボーナス** - 新規紹介活動報酬
7. **ロイヤルファミリーボーナス** - 最高タイトル保持者への特別報酬

### タイトル体系
- スタート → リーダー → サブマネージャー → マネージャー → エキスパートマネージャー → ディレクター → エリアディレクター

## 🏦 報酬支払い
### GMOネットバンクCSVフォーマット
- 銀行コード
- 支店コード
- 口座種別（1:普通、2:当座）
- 口座番号
- 受取人名（カタカナ）
- 振込金額
- 手数料負担（空欄=会社負担）
- EDI情報（空欄）

### 支払いルール
- **最低支払金額**: 5,000円（未満は翌月繰越）
- **振込手数料**: 会社負担

## 🏦 報酬支払い（旧）
- **GMOネットバンク**の一括振込機能を利用
- システムから振込用CSVデータを出力
- フォーマット: [口座情報, 振込金額, 受取人名等]

## 👥 MLM組織管理
### 重要機能
- **組織図の視覚的表示**
- **退会処理と組織圧縮** - 退会者が出た場合、その下の会員を上位スポンサーに自動接続
- **タイトル昇格の自動判定**
- **各種実績の追跡**

## ⚠️ 特に重要な注意点
1. **会員データ項目が多い** - 完全移行のため全項目を慎重に設計
2. **報酬計算の複雑性** - 7種類のボーナス計算ロジックの正確な実装
3. **組織図の圧縮処理** - 退会時の組織再編成の正確性
4. **CSV入出力の互換性** - Univapay、GMOネットバンクとの完全互換

## 📁 参考資料
- `/home/matsuura/Desktop/BOSS-system-new2/gaiyou/gaiyou1.png` - 報酬計算詳細（前半）
- `/home/matsuura/Desktop/BOSS-system-new2/gaiyou/gaiyou2.png` - 報酬計算詳細（後半）

## ✅ 成功基準
- 月額利用料: 10万円 → 0円
- 機能再現度: 100%
- 報酬計算精度: 100%
- CSV入出力成功率: 100%
- システム稼働率: 99.5%以上

## 🗂️ 会員データ項目（29項目）- 完全再現必須

### 会員マスタ項目一覧
1. ステータス（選択肢）
2. IROAS会員番号
3. 氏名
4. カナ
5. メールアドレス
6. 称号（選択肢）
7. ユーザータイプ（選択肢）
8. 加入プラン（選択肢）
9. 決済方法（選択肢）
10. 登録日（テキスト入力）
11. 退会日
12. 電話番号
13. 性別（選択肢）
14. 郵便番号
15. 都道府県
16. 住所2
17. 住所3
18. 直上者ID
19. 直上者名
20. 紹介者ID
21. 紹介者名
22. 報酬振込先の銀行名
23. 報酬振込先の銀行コード
24. 報酬振込先の支店名
25. 報酬振込先の支店コード
26. 口座番号
27. ゆうちょの場合の記号
28. ゆうちょの場合の番号
29. 口座種別
30. 備考

### 選択肢マスタ
**ステータス**: アクティブ / 休会中 / 退会済
**称号**: 称号なし / ナイト/デイム / ロード/レディ / キング/クイーン / エンペラー/エンブレス
**ユーザータイプ**: 通常 / 注意
**加入プラン**: ヒーロープラン / テストプラン
**決済方法**: カード決済 / 口座振替 / 銀行振込 / インフォカート
**性別**: 男性 / 女性 / その他
**口座種別**: 普通 / 当座

### 重要な仕様
- **会員番号**: 7桁の数字（手動入力）
- **退会処理**: 退会後、手動で組織調整を行う画面が必要（自動圧縮NG）
- **検索条件**: 会員番号、氏名、メールアドレス

## 📋 必要なページリスト（9ページ）

### ページ構成
1. **P-001: ダッシュボード（ホーム）**
   - 目的：システム全体の状況を一目で把握
   - 統合機能：売上サマリー、決済状況、報酬支払予定、直近の活動

2. **P-002: 会員管理**
   - 目的：会員の登録・編集・退会処理・組織管理を統合
   - 統合機能：会員一覧、詳細編集、退会処理、組織変更、タイトル管理

3. **P-003: 組織図ビューア**
   - 目的：MLM組織構造の視覚的表示と階層確認
   - 統合機能：ツリー表示、階層検索、スポンサー変更、実績表示

4. **P-004: 決済管理**
   - 目的：Univapay CSV出力、決済結果取込、手動決済記録を統合
   - 統合機能：CSV出力（カード/口座）、結果取込、手動記録、決済履歴

5. **P-005: 報酬計算**
   - 目的：7種類のボーナス計算実行と計算結果確認
   - 統合機能：計算実行、詳細確認、計算履歴、エラーチェック

6. **P-006: 報酬支払管理**
   - 目的：GMOネットバンク振込CSV生成と支払履歴管理
   - 統合機能：CSV生成、支払確定、履歴管理、支払統計

7. **P-007: アクティビティログ**
   - 目的：システムで実行された全操作の履歴を時系列で確認
   - 統合機能：操作履歴、フィルタリング、詳細表示

8. **P-008: マスタ設定**
   - 目的：システム固定値の確認表示のみ（変更不可）
   - 統合機能：固定値表示（参加費、タイトル条件、報酬率）

9. **P-009: データ入出力**
   - 目的：各種CSV入出力、バックアップ、データ移行機能
   - 統合機能：インポート、エクスポート、バックアップ、リストア

### 開発方針
- **認証機能**: 初期はなし（ステップ21で追加）
- **理由**: 管理者のみ使用のため初期は認証なしで開発効率を優先

---
**このファイルは要件定義の過程で最も重要な情報をまとめたものです。**
**開発中は常にこの内容を参照し、要件との整合性を確認してください。**