# 重要：組織データのソースについて

## 現在の仕様（2024年12月26日更新）

### ✅ 正しい使用方法
- **組織データの取得**: `organization_positions`テーブルから取得
- **会員データ**: `members`テーブルから取得
- **退会者データ**: `withdrawals`テーブルから取得

### ❌ 使用しないでください
- `/csv/`フォルダのCSVファイルを直接読み込まない
- `organization.py`の古いCSV読み込み関数は使用しない

## CSVファイルの用途

CSVファイルは以下の目的**のみ**で使用します：

1. **初期データインポート**: `rebuild_organization_with_hierarchy.py`スクリプトを実行時
2. **データ復旧**: データベースが破損した場合の再構築

## データベース再構築が必要な場合

```bash
# 組織データを再構築
python3 rebuild_organization_with_hierarchy.py
```

## 2024年12月26日更新: CSVファイルの移動

セキュリティとアクセス制御のため、CSVファイルは`/archive/csv/`フォルダに移動されました：

- **旧パス**: `/csv/original_2025年8月組織図（バイナリ）.csv`
- **新パス**: `/archive/csv/original_2025年8月組織図（バイナリ）.csv`

これにより、通常の開発作業中に誤ってCSVファイルを参照することを防げます。

## APIエンドポイント

### 正しいエンドポイント（データベース使用）
- `GET /api/v1/organization/tree` - 組織ツリー取得
- `GET /api/v1/organization/stats` - 統計情報取得

### 注意
以下のエンドポイントはCSVを参照している可能性があります（要修正）：
- `/api/v1/organization/test`
- `/api/v1/organization/export/csv`

## トラブルシューティング

### 問題：古いテストデータが表示される
**原因**: CSVファイルを直接読み込んでいる
**解決**: APIがデータベースから読み込むように修正されているか確認

### 問題：階層構造が正しくない  
**原因**: parent_idの関係が正しく構築されていない
**解決**: `rebuild_organization_with_hierarchy.py`を実行して再構築

## 今後の改善案

1. CSVフォルダを`/archive/`や`/import-source/`など明確な名前に変更
2. 古いCSV読み込み関数を完全に削除
3. データインポートツールを別プロジェクトに分離